<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FADoc - Aplicativo de Gerenciamento de Pedidos e Orçamentos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <script>
    	function alternarFooter() {
		const footer = document.getElementById('footer');
		const icon = document.getElementById('footerIcon');

		if (footer.style.display === "none" || footer.style.display === "") {
			footer.style.display = "block";
			icon.classList.remove('fa-chevron-up');
			icon.classList.add('fa-chevron-down');
			window.scrollTo({
				top: document.body.scrollHeight,
				behavior: 'smooth'
			});
		} else {
			footer.style.display = "none";
			icon.classList.remove('fa-chevron-down');
			icon.classList.add('fa-chevron-up');
		}
	}
   </script>
   <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

    * {
        box-sizing: border-box;
    }

    body {
        font-family: 'Inter', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f9f9f9;
        color: #222;
    }

    .container {
        max-width: 960px;
        margin: auto;
        padding: 20px;
    }

    .header {
        background-color: #111;
        color: white;
        padding: 30px 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        border-radius: 10px;
    }

    .logo {
        max-width: 80px;
        margin-bottom: 10px;
    }

    .company-info h1 {
        font-size: 24px;
        margin: 0;
    }

    .company-info p {
        margin: 5px 0;
    }

    .content {
        background-color: #fff;
        padding: 25px;
        margin-top: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    h2 {
        margin-top: 0;
        font-size: 20px;
        color: #444;
        border-bottom: 1px solid #eee;
        padding-bottom: 8px;
        margin-bottom: 15px;
    }

    .client-info,
    .service-info,
    .items-info {
        margin-bottom: 30px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    th, td {
        padding: 12px;
        border: 1px solid #ddd;
        text-align: center;
    }

    th {
        background-color: #f0f0f0;
        font-weight: 600;
    }

    tfoot td {
        background-color: #fafafa;
        font-weight: bold;
    }

    .footer {
        margin-top: 20px;
	padding: 20px;
	background-color: #111;
	color: white;
	text-align: center;
	border-radius: 10px 10px 0 0;
	display: none;
	transition: all 0.3s ease;
	position: fixed;
	bottom: 0;
	left: 0;
	right: 0;
	z-index: 1000;
    }

    .footer p {
        margin-top: 10px;
        font-size: 14px;
        color: #ccc;
    }

    .footer a {
        color: #4ad295;
        font-weight: 500;
    }

    .toggle-footer-btn {
	position: fixed;
	bottom: 16px;
	right: 16px;
	width: 42px;
	height: 42px;
	font-size: 18px;
	border-radius: 50%;
	background-color: #4ad295;
	color: white;
	border: none;
	cursor: pointer;
	box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
	z-index: 1100;
	display: flex;
	align-items: center;
	justify-content: center;
	transition: transform 0.2s ease;
     }

     .toggle-footer-btn:hover {
	background-color: #3bbf83;
	transform: scale(1.05);
     }

    button {
        background-color: #4ad295;
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    button:hover {
        background-color: #3bbf83;
    }

    @media (max-width: 600px) {
        .header, .content, .footer {
            padding: 15px;
        }

        th, td {
            font-size: 14px;
            padding: 8px;
        }

        .company-info h1 {
            font-size: 20px;
        }

        h2 {
            font-size: 18px;
        }

        button {
            width: 100%;
            margin: 8px 0;
        }
    }

    @media print {
        #print-button {
            display: none !important;
        }

        .footer {
            background: none;
            color: black;
        }
    }
</style>
</head>
<body>
    <main id="conteudo">
        <!-- O conteúdo da página será inserido aqui dinamicamente -->
    </main>

    <script>
        // Função para imprimir a página
        function imprimirPagina() {
            window.print();
        }
    </script>
    <script>
        // Função para obter os parâmetros da URL
        function obterParametrosDaURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const pedidos = urlParams.get("pedido");
            const descs = urlParams.get("desc");
			const itens = urlParams.get("item");
			const totais = urlParams.get("total");
			const logos = urlParams.get("logo");
			const empresas = urlParams.get("empresa");
			const clientes = urlParams.get("cliente");
			const servicos = urlParams.get("servico");
			const tokens = urlParams.get("token");
			const nomes = urlParams.get("nome");

            return { pedidos, descs, itens, totais, logos, empresas, clientes, servicos, tokens, nomes };
        }

        // Função para carregar e exibir o conteúdo com base nos parâmetros da URL
        function carregarPaginaComParametros() {
            const parametros = obterParametrosDaURL();
			document.title = parametros.nomes + ' - ' + parametros.pedidos;

            // Verifique se os parâmetros necessários estão presentes
            if (!parametros.pedidos || !parametros.descs) {
                document.getElementById("conteudo").innerHTML = "<p>Parâmetros ausentes. Certifique-se de passar os parametros na URL.</p>";
                return;
            }

            // Construa o conteúdo com base nos parâmetros
            const conteudo = `
                
				<div class="container" id="container">
						<div class="header">
							<div>
								<img src="${parametros.logos}" alt="${parametros.nomes}" class="logo">
							</div>
							<div class="company-info">
								<h1>${parametros.nomes}</h1>
								${parametros.empresas}
								<h4>${parametros.descs}</h4>
							</div>
						</div>

						<div class="content">
							<div class="client-info">
								<h2>Informações do Cliente</h2>
								${parametros.clientes}
							</div>
							
							<div class="service-info">
								<h2>Detalhes do Serviço</h2>
								${parametros.servicos}
							</div>
							
							<div class="items-info">
								<h2>Itens do Serviço</h2>
								<table>
									<thead>
										<tr>
										<th>Qtade</th>
										<th>Descrição</th>
										<th>Valor Unitário</th>
										<th>Total</th>
										</tr>
									</thead>
									<tbody>
										${parametros.itens}
									</tbody>
									<tfoot>
										<tr>
											<td colspan="3">Total:</td>
											<td>${parametros.totais}</td>
										</tr>
									</tfoot>
								</table>
							</div>
       							<p style="text-align: center; font-size: 12px; color: #888; margin-top: 50px;">
								&copy; <span id="ano"></span> Gerado pelo aplicativo 
								<a target="_blank" href="https://api.whatsapp.com/send?phone=5514998050249" style="color: #4ad295; text-decoration: none;">FADoc</a> - (14) 99805-0249.
							</p>
						</div>
				</div>
    				<div id="print-button">
					<button id="toggleFooterBtn" onclick="alternarFooter()" class="toggle-footer-btn" title="Mostrar/Ocultar Rodapé">
						<i class="fas fa-chevron-up" id="footerIcon"></i>
					</button>
					<div class="footer" id="footer">
						<button onclick="window.print()">Imprimir</button>
						<button onclick="encurtarECompartilhar()">Compartilhar</button>
						<button id="btnGerarPDF">Gerar PDF</button>
					</div>
				</div>
				
            `;

            // Insira o conteúdo gerado na página
            document.getElementById("conteudo").innerHTML = conteudo;
        }

        // Chame a função para carregar a página com base nos parâmetros da URL
        carregarPaginaComParametros();
    </script>
	<script>
	 function encurtarURL(longURL, accessToken) {
            var endpoint = "https://api.tinyurl.com/create";
            var requestOptions = {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + accessToken,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    url: longURL
                })
            };

            return fetch(endpoint, requestOptions)
                .then(response => response.json())
                .then(data => {
                    return Object.values(data)[0].alias;
                })
                .catch(error => {
                    console.error('Erro ao encurtar a URL:', error);
                });
        }

        function encurtarECompartilhar() {
            var longURL = window.location.href; // Obtém a URL da página atual
	    var params = obterParametrosDaURL();
	    var accessToken = params.tokens;
	    var titulo = params.nomes + ' - ' + params.pedidos;
	    var pedido = params.pedidos;
		
            encurtarURL(longURL, accessToken)
                .then(shortURL => {
                    // Compartilhar a URL encurtada
                    if (navigator.share) {
                        navigator.share({
                            title: titulo,
                            text: 'Segue link do ' + pedido + ': ',
                            url: 'https://tinyurl.com/' + shortURL
                        })
                        .then(() => console.log('URL compartilhada com sucesso!'))
                        .catch(error => console.error('Erro ao compartilhar:', error));
                    } else {
                        console.error('A API de compartilhamento não é suportada neste navegador.');
                    }
                });
        }

	</script>
	<script>
        // Criar um novo elemento link
        var favicon = document.createElement('link');
		
		var parametrologo = obterParametrosDaURL();
	    var favlogo = parametrologo.logos;
        
        // Definir os atributos do link
        favicon.rel = 'icon';
        favicon.href = favlogo;
        favicon.type = 'image/x-icon';
        
        // Adicionar o novo favicon ao cabeçalho do documento
        document.head.appendChild(favicon);
    </script>
    <script>
        document.getElementById('btnGerarPDF').addEventListener('click', function() {
			var parametro = obterParametrosDaURL();
			var titulo = parametro.nomes + ' - ' + parametro.pedidos;
            var element = document.getElementById('container');
            html2pdf()
                .from(element)
                .save(titulo + '.pdf');
        });
    </script>
    <script>
	document.getElementById("ano").textContent = new Date().getFullYear();
    </script>
</body>
</html>
